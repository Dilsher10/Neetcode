<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word Search II</title>
</head>

<body>
    <script>
        class TrieNode {
            constructor() {
                this.children = new Map();
                this.endOfWord = false;
            }
        }

        var findWords = function (board, words) {
            const root = new TrieNode();

            const addWord = (word) => {
                let cur = root;
                for (let c of word) {
                    if (!cur.children.has(c)) {
                        cur.children.set(c, new TrieNode());
                    }
                    cur = cur.children.get(c);
                }
                cur.endOfWord = true;
            };


            for (const word of words) {
                addWord(word);
            }


            const rows = board.length;
            const cols = board[0].length;
            const res = new Set();
            const visited = Array.from({ length: rows }, () => Array(cols).fill(false));

            const dfs = (r, c, node, word) => {
                if (
                    r < 0 || c < 0 || r >= rows || c >= cols ||
                    visited[r][c] || !node.children.has(board[r][c])
                ) {
                    return;
                }

                const char = board[r][c];
                visited[r][c] = true;
                node = node.children.get(char);
                word += char;

                if (node.endOfWord) {
                    res.add(word);
                    node.endOfWord = false;
                }

                dfs(r + 1, c, node, word);
                dfs(r - 1, c, node, word);
                dfs(r, c + 1, node, word);
                dfs(r, c - 1, node, word);

                visited[r][c] = false;
            };

            for (let r = 0; r < rows; r++) {
                for (let c = 0; c < cols; c++) {
                    dfs(r, c, root, '');
                }
            }

            return Array.from(res);
        };


        const board = [
            ['o', 'a', 'a', 'n'],
            ['e', 't', 'a', 'e'],
            ['i', 'h', 'k', 'r'],
            ['i', 'f', 'l', 'v']
        ];
        const words = ["oath", "pea", "eat", "rain"];
        const result = findWords(board, words);
        console.log(result);
    </script>
</body>

</html>