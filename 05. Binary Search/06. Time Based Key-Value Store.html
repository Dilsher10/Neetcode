<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time Based Key-Value Store</title>
</head>

<body>
    <script>
        // Method 1

        class TimeMap {
            constructor() {
                this.keyStore = new Map();
            }

            set(key, value, timestamp) {
                if (!this.keyStore.has(key)) {
                    this.keyStore.set(key, []);
                }
                this.keyStore.get(key).push([timestamp, value]);
            }

            get(key, timestamp) {
                const values = this.keyStore.get(key) || [];
                let left = 0;
                let right = values.length - 1;
                let result = '';

                while (left <= right) {
                    const mid = Math.floor((left + right) / 2);

                    if (values[mid][0] <= timestamp) {
                        result = values[mid][1];
                        left = mid + 1;
                    } else {
                        right = mid - 1;
                    }
                }

                return result;
            }
        }






        // Method 2

        class TimeMap {
            constructor() {
                this.store = new Map(); // key -> array of [timestamp, value]
            }

            set(key, value, timestamp) {
                if (!this.store.has(key)) {
                    this.store.set(key, []);
                }
                this.store.get(key).push([timestamp, value]);
            }

            get(key, timestamp) {
                if (!this.store.has(key)) return "";

                const items = this.store.get(key);
                let left = 0, right = items.length - 1;
                let result = "";

                while (left <= right) {
                    let mid = Math.floor((left + right) / 2);
                    let [midTimestamp, midValue] = items[mid];

                    if (midTimestamp === timestamp) {
                        return midValue;
                    } else if (midTimestamp < timestamp) {
                        result = midValue;  // potential answer, search right
                        left = mid + 1;
                    } else {
                        right = mid - 1;
                    }
                }

                return result;
            }
        }


        let timeMap = new TimeMap();
        timeMap.set("foo", "bar", 1);
        console.log(timeMap.get("foo", 1)); // "bar"
        console.log(timeMap.get("foo", 3)); // "bar"
        timeMap.set("foo", "bar2", 4);
        console.log(timeMap.get("foo", 4)); // "bar2"
        console.log(timeMap.get("foo", 5)); // "bar2"
    </script>
</body>

</html>